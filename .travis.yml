language: python

install:
  - pip install obspy pandas pytz netCDF4 pyerf
  - pip install .
  - git clone https://github.com/xumi1993/seispy-test test

jobs:
  include:
    - stage: test
      python: "3.7"

    - stage: test
      python: "3.8"
      script: bash test/run.sh

    - stage: test
      python: "3.9"
      script: bash test/run.sh

    - stage: doc
      script: bash -c "$(curl -fsSL https://git.nju.edu.cn/xumi1993/source/-/raw/master/trigger.sh)"

  deploy:
    provide: pypi
    username: "__token__"
    password: "pypi-AgEIcHlwaS5vcmcCJGU4YWFhZGZiLWJhMWYtNDc2Ny05MGE4LTI1ZGQ0YzdhOTlmYQACPnsicGVybWlzc2lvbnMiOiB7InByb2plY3RzIjogWyJweXRob24tc2Vpc3B5Il19LCAidmVyc2lvbiI6IDF9AAAGIB2ym-ryHlelQcHNzDEIta7v33GmhDcrjfuX05-JswJv"
    on:
      python: 3.8
      branch: master
