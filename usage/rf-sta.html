
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Calculate PRFs for single station &#8212; seispy latest documentation</title>
<script>
  document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
  document.documentElement.dataset.theme = localStorage.getItem("theme") || "light"
</script>

  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=92025949c220c2e29695" rel="stylesheet">
<link href="../_static/styles/pydata-sphinx-theme.css?digest=92025949c220c2e29695" rel="stylesheet">


  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />

  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=92025949c220c2e29695">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/design-tabs.js"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="canonical" href="seispy.xumijian.me/usage/rf-sta.html" />
    <link rel="shortcut icon" href="../_static/seispy_100.png"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Calculate S wave Receiver Functions (SRF) for single station" href="srf.html" />
    <link rel="prev" title="Calculate a P-wave Receiver Function (PRF)" href="PRF_Process.html" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta name="docsearch:language" content="None">
  </head>
  
  
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="180" data-default-mode="">
    <div class="bd-header-announcement container-fluid" id="banner">
      

    </div>

    
    <nav class="bd-header navbar navbar-light navbar-expand-lg bg-light fixed-top bd-navbar" id="navbar-main"><div class="bd-header__inner container-xl">

  <div id="navbar-start">
    
    
  


<a class="navbar-brand logo" href="../index.html">
  
  
  
  
    <img src="../_static/seispy-long.png" class="logo__image only-light" alt="Logo image">
    <img src="../_static/seispy-long.png" class="logo__image only-dark" alt="Logo image">
  
  
</a>
    
  </div>

  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-collapsible" aria-controls="navbar-collapsible" aria-expanded="false" aria-label="Toggle navigation">
    <span class="fas fa-bars"></span>
  </button>

  
  <div id="navbar-collapsible" class="col-lg-9 collapse navbar-collapse">
    <div id="navbar-center" class="mr-auto">
      
      <div class="navbar-center-item">
        <ul id="navbar-main-elements" class="navbar-nav">
    <li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../installation.html">
  Installation
 </a>
</li>

<li class="toctree-l1 current active nav-item">
 <a class="reference internal nav-link" href="index.html">
  Getting Started
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../examples/index.html">
  Examples
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../notes/index.html">
  Configurations
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../modules.html">
  Module Index
 </a>
</li>

    
</ul>
      </div>
      
    </div>

    <div id="navbar-end">
      
      <div class="navbar-end-item">
        <span id="theme-switch" class="btn btn-sm btn-outline-primary navbar-btn rounded-circle">
    <a class="theme-switch" data-mode="light"><i class="fas fa-sun"></i></a>
    <a class="theme-switch" data-mode="dark"><i class="far fa-moon"></i></a>
    <a class="theme-switch" data-mode="auto"><i class="fas fa-adjust"></i></a>
</span>
      </div>
      
      <div class="navbar-end-item">
        <ul id="navbar-icon-links" class="navbar-nav" aria-label="Icon Links">
        <li class="nav-item">
          <a class="nav-link" href="https://github.com/xumi1993/seispy" rel="noopener" target="_blank" title="GitHub"><span><i class="fab fa-github-square"></i></span>
            <label class="sr-only">GitHub</label></a>
        </li>
      </ul>
      </div>
      
    </div>
  </div>
</div>
    </nav>
    

    <div class="bd-container container-xl">
      <div class="bd-container__inner row">
          

<!-- Only show if we have sidebars configured, else just a small margin  -->
<div class="bd-sidebar-primary col-12 col-md-3 bd-sidebar">
  <div class="sidebar-start-items"><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
  <div class="bd-toc-item active">
    <ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="PRF_Process.html">
   Calculate a P-wave Receiver Function (PRF)
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Calculate PRFs for single station
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="srf.html">
   Calculate S wave Receiver Functions (SRF) for single station
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="pickrf.html">
   Visual check PRFs with an user interface
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="ccp.html">
   Stack PRFs with Common Conversion points (CCP) method
  </a>
 </li>
</ul>

  </div>
</nav>
  </div>
  <div class="sidebar-end-items">
  </div>
</div>


          


<div class="bd-sidebar-secondary d-none d-xl-block col-xl-2 bd-toc">
  
    
    <div class="toc-item">
      
<div class="tocsection onthispage mt-5 pt-1 pb-3">
    <i class="fas fa-list"></i> On this page
</div>

<nav id="bd-toc-nav">
    <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#prepare-seismic-records-order-by-stations">
   Prepare seismic records order by stations
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#calculate-prfs-using-a-simple-command">
   Calculate PRFs using a simple command
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#prepare-a-configure-file">
     Prepare a configure file
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#run-in-command-line">
   Run in command line
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#initialize-a-project-instance">
   Initialize a project instance
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#set-parameters">
   Set parameters
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#search-earthquakes-from-catalog">
   Search earthquakes from catalog
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#load-station-information">
     Load station information
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#search-earthquakes">
   Search earthquakes
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#associate-sac-files-with-events">
   Associate SAC files with events
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#pre-processing">
   Pre-processing
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#filter">
     Filter
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#signal-noise-ratios-snr-calculation">
     Signal-noise-ratios (SNR) calculation
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#trim">
     Trim
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#saving-and-loading-this-project">
   Saving and loading this project
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#save-this-project">
     Save this project
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#load-this-project">
     Load this project
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#prfs-calculation">
   PRFs calculation
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#save-prfs">
   Save PRFs
  </a>
 </li>
</ul>

</nav>
    </div>
    
    <div class="toc-item">
      
    </div>
    
  
</div>


          
          
          <div class="bd-content col-12 col-md-9 col-xl-7">
              
              <article class="bd-article" role="main">
                
  <section id="calculate-prfs-for-single-station">
<h1>Calculate PRFs for single station<a class="headerlink" href="#calculate-prfs-for-single-station" title="Permalink to this headline">#</a></h1>
<section id="prepare-seismic-records-order-by-stations">
<h2>Prepare seismic records order by stations<a class="headerlink" href="#prepare-seismic-records-order-by-stations" title="Permalink to this headline">#</a></h2>
<p>Seismic data including direct P arrival should be trimmed according earthquakes. Meanwhile, the data should be order by stations instead of events. For example, YN001 and YN002 are stations; the SAC files are teleseismic data records of these stations.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>    event_data/
    ├── YN001
    │   ├── 2018.229.15.35.02.1.sac
    │   ├── 2018.229.15.35.02.2.sac
    │   ├── 2018.229.15.35.02.3.sac
    │   ├── 2018.229.22.06.55.1.sac
    │   ├── 2018.229.22.06.55.2.sac
    │   │......
    ├── YN002
    │   ├── 2018.229.15.35.02.1.sac
    │   ├── 2018.229.15.35.02.2.sac
    │   ├── 2018.229.15.35.02.3.sac
    │   ├── 2018.229.22.06.55.1.sac
    │   ├── 2018.229.22.06.55.2.sac
    │   │......
</pre></div>
</div>
</section>
<section id="calculate-prfs-using-a-simple-command">
<h2>Calculate PRFs using a simple command<a class="headerlink" href="#calculate-prfs-using-a-simple-command" title="Permalink to this headline">#</a></h2>
<section id="prepare-a-configure-file">
<h3>Prepare a configure file<a class="headerlink" href="#prepare-a-configure-file" title="Permalink to this headline">#</a></h3>
<p>We should prepare a configure file as following including all parameters that will be set during the calculation. The format is following Python module of <a class="reference external" href="https://docs.python.org/3/library/configparser.html">configparser</a>. We have provided a template configure file in <a class="reference internal" href="../notes/rf_cfg.html"><span class="doc">RF calculation</span></a>. See comment in detail.</p>
</section>
</section>
<section id="run-in-command-line">
<h2>Run in command line<a class="headerlink" href="#run-in-command-line" title="Permalink to this headline">#</a></h2>
<p>We have provided the command <code class="docutils literal notranslate"><span class="pre">prf</span></code>. The usage is shown as:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">usage</span><span class="p">:</span> <span class="n">prf</span> <span class="p">[</span><span class="o">-</span><span class="n">h</span><span class="p">]</span> <span class="p">[</span><span class="o">-</span><span class="n">l</span><span class="p">]</span> <span class="p">[</span><span class="o">-</span><span class="n">r</span> <span class="n">N</span><span class="o">|</span><span class="n">E</span><span class="o">|</span><span class="n">NE</span><span class="p">]</span> <span class="p">[</span><span class="o">-</span><span class="n">s</span><span class="p">]</span> <span class="p">[</span><span class="o">-</span><span class="n">b</span> <span class="p">[</span><span class="n">BAZ</span><span class="p">]]</span> <span class="p">[</span><span class="o">-</span><span class="n">w</span><span class="p">]</span> <span class="p">[</span><span class="o">-</span><span class="n">f</span> <span class="n">finallist</span><span class="p">]</span> <span class="n">cfg_file</span>

  <span class="n">Calculating</span> <span class="n">RFs</span> <span class="k">for</span> <span class="n">single</span> <span class="n">station</span>

  <span class="n">positional</span> <span class="n">arguments</span><span class="p">:</span>
    <span class="n">cfg_file</span>      <span class="n">Path</span> <span class="n">to</span> <span class="n">RF</span> <span class="n">configure</span> <span class="n">file</span>

  <span class="n">optional</span> <span class="n">arguments</span><span class="p">:</span>
    <span class="o">-</span><span class="n">h</span><span class="p">,</span> <span class="o">--</span><span class="n">help</span>    <span class="n">show</span> <span class="n">this</span> <span class="n">help</span> <span class="n">message</span> <span class="ow">and</span> <span class="n">exit</span>
    <span class="o">-</span><span class="n">l</span>            <span class="n">use</span> <span class="n">local</span> <span class="n">catalog</span><span class="p">,</span> <span class="n">defaults</span> <span class="n">to</span> <span class="n">false</span>
    <span class="o">-</span><span class="n">r</span> <span class="n">N</span><span class="o">|</span><span class="n">E</span><span class="o">|</span><span class="n">NE</span>     <span class="n">Reverse</span> <span class="n">components</span><span class="p">:</span> <span class="n">N</span><span class="p">,</span> <span class="n">E</span> <span class="ow">or</span> <span class="n">NE</span>
    <span class="o">-</span><span class="n">s</span>            <span class="n">Switch</span> <span class="n">the</span> <span class="n">East</span> <span class="ow">and</span> <span class="n">North</span> <span class="n">components</span>
    <span class="o">-</span><span class="n">b</span> <span class="p">[</span><span class="n">BAZ</span><span class="p">]</span>      <span class="n">Correct</span> <span class="n">back</span><span class="o">-</span><span class="n">azimuth</span><span class="o">.</span> <span class="n">If</span> <span class="s2">&quot;baz&quot;</span> <span class="ow">is</span> <span class="n">specified</span><span class="p">,</span> <span class="n">the</span> <span class="n">corr_baz</span> <span class="o">=</span> <span class="n">raw_baz</span> <span class="o">+</span> <span class="n">baz</span><span class="o">.</span> <span class="n">If</span> <span class="n">there</span> <span class="ow">is</span> <span class="n">no</span> <span class="n">argument</span><span class="p">,</span> <span class="n">the</span> <span class="n">back</span><span class="o">-</span><span class="n">azimuth</span> <span class="n">will</span> <span class="n">be</span> <span class="n">corrected</span> <span class="k">with</span> <span class="n">minimal</span> <span class="n">energy</span>
                  <span class="n">of</span> <span class="n">T</span> <span class="n">component</span><span class="o">.</span> <span class="n">The</span> <span class="n">searching</span> <span class="nb">range</span> <span class="ow">is</span> <span class="n">raw_baz</span> <span class="o">+/-</span> <span class="mi">90</span>
    <span class="o">-</span><span class="n">w</span>            <span class="n">Write</span> <span class="n">project</span> <span class="n">to</span> <span class="n">localfile</span>
    <span class="o">-</span><span class="n">f</span> <span class="n">finallist</span>  <span class="n">Specify</span> <span class="n">finallist</span> <span class="k">for</span> <span class="n">re</span><span class="o">-</span><span class="n">calculating</span> <span class="n">RFs</span> <span class="ow">and</span> <span class="o">-</span><span class="n">l</span> <span class="ow">is</span> <span class="n">invalid</span> <span class="ow">in</span> <span class="n">this</span> <span class="n">pattern</span>
</pre></div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">cfg_file</span></code>: configure file.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-l</span></code> if the argument was specified, a local file of catalog would be used in searching earthquakes.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-r</span></code> Reverse the horizontal components. The arguments should be in <code class="docutils literal notranslate"><span class="pre">EN</span></code>, <code class="docutils literal notranslate"><span class="pre">E</span></code> or <code class="docutils literal notranslate"><span class="pre">N</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-s</span></code> If this option is specified, the East and North components would be changed.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-b</span></code> Correct back-azimuth. If <span class="math notranslate nohighlight">\(baz\)</span> is specified, the <span class="math notranslate nohighlight">\(baz_{corr} = baz_{raw} + baz\)</span>. If no arguments following <code class="docutils literal notranslate"><span class="pre">-b</span></code>,  back-azimuth will be corrected for grid searching minimal energy of T component. The searching range is <span class="math notranslate nohighlight">\(baz_{raw} \pm 90^{\circ}\)</span></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-f</span></code> Add a path to final-list following this option. Event information in the final-list is used instead of searching earthquakes from catalog.</p></li>
</ul>
</section>
<section id="initialize-a-project-instance">
<h2>Initialize a project instance<a class="headerlink" href="#initialize-a-project-instance" title="Permalink to this headline">#</a></h2>
<p><strong>To further understand the procedure of the command</strong>  <code class="docutils literal notranslate"><span class="pre">prf</span></code> <strong>, we recommend calculating PRFs with writing a Python script as following steps.</strong></p>
<p>First, let’s initialize a <code class="docutils literal notranslate"><span class="pre">RF</span></code>instance. In this instance, we can set parameters and calculate PRFs using functions of the class.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">seispy.rf</span> <span class="kn">import</span> <span class="n">RF</span>
<span class="kn">from</span> <span class="nn">os.path</span> <span class="kn">import</span> <span class="n">join</span>
<span class="kn">from</span> <span class="nn">obspy</span> <span class="kn">import</span> <span class="n">UTCDateTime</span>

<span class="n">pjt</span> <span class="o">=</span> <span class="n">RF</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="set-parameters">
<h2>Set parameters<a class="headerlink" href="#set-parameters" title="Permalink to this headline">#</a></h2>
<p>Most of parameters are saved in the class <code class="docutils literal notranslate"><span class="pre">pjt.para</span></code>. All default parameters are shown as following</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">pjt</span><span class="o">.</span><span class="n">para</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="s1">&#39;_datapath&#39;</span><span class="p">:</span> <span class="s1">&#39;/Users/xumj&#39;</span><span class="p">,</span>
<span class="s1">&#39;_rfpath&#39;</span><span class="p">:</span> <span class="s1">&#39;/Users/xumj&#39;</span><span class="p">,</span>
<span class="s1">&#39;_imagepath&#39;</span><span class="p">:</span> <span class="s1">&#39;/Users/xumj&#39;</span><span class="p">,</span>
<span class="s1">&#39;_catalogpath&#39;</span><span class="p">:</span> <span class="s1">&#39;/Users/xumj/.pyenv/versions/anaconda3-5.3.1/lib/python3.7/site-packages/seispy-1.1.8-py3.7.egg/seispy/data/EventCMT.dat&#39;</span><span class="p">,</span>
<span class="s1">&#39;offset&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
<span class="s1">&#39;tolerance&#39;</span><span class="p">:</span> <span class="mi">210</span><span class="p">,</span>
<span class="s1">&#39;dateformat&#39;</span><span class="p">:</span> <span class="s1">&#39;%Y.%j.%H.%M.%S&#39;</span><span class="p">,</span>
<span class="s1">&#39;date_begin&#39;</span><span class="p">:</span> <span class="mi">1976</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span><span class="n">T00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mf">00.000000</span><span class="n">Z</span><span class="p">,</span>
<span class="s1">&#39;date_end&#39;</span><span class="p">:</span> <span class="mi">2019</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">11</span><span class="n">T14</span><span class="p">:</span><span class="mi">04</span><span class="p">:</span><span class="mf">15.365860</span><span class="n">Z</span><span class="p">,</span>
<span class="s1">&#39;magmin&#39;</span><span class="p">:</span> <span class="mf">5.5</span><span class="p">,</span>
<span class="s1">&#39;magmax&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
<span class="s1">&#39;dismin&#39;</span><span class="p">:</span> <span class="mi">30</span><span class="p">,</span>
<span class="s1">&#39;dismax&#39;</span><span class="p">:</span> <span class="mi">90</span><span class="p">,</span>
<span class="s1">&#39;ref_comp&#39;</span><span class="p">:</span> <span class="s1">&#39;BHZ&#39;</span><span class="p">,</span>
<span class="s1">&#39;suffix&#39;</span><span class="p">:</span> <span class="s1">&#39;SAC&#39;</span><span class="p">,</span>
<span class="s1">&#39;noisegate&#39;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
<span class="s1">&#39;gauss&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
<span class="s1">&#39;target_dt&#39;</span><span class="p">:</span> <span class="mf">0.01</span><span class="p">,</span>
<span class="s1">&#39;phase&#39;</span><span class="p">:</span> <span class="s1">&#39;P&#39;</span><span class="p">,</span>
<span class="s1">&#39;time_before&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
<span class="s1">&#39;time_after&#39;</span><span class="p">:</span> <span class="mi">120</span><span class="p">,</span>
<span class="s1">&#39;only_r&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">}</span>
</pre></div>
</div>
<p>Thus, we can set them in our scripts</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">pjt</span><span class="o">.</span><span class="n">para</span><span class="o">.</span><span class="n">datapath</span> <span class="o">=</span> <span class="s1">&#39;Data/Path/to/station_name&#39;</span>
<span class="n">pjt</span><span class="o">.</span><span class="n">para</span><span class="o">.</span><span class="n">rfpath</span> <span class="o">=</span> <span class="s1">&#39;Result/Path/to/station_name&#39;</span>
<span class="n">pjt</span><span class="o">.</span><span class="n">para</span><span class="o">.</span><span class="n">suffix</span> <span class="o">=</span> <span class="s1">&#39;sac&#39;</span>
<span class="n">pjt</span><span class="o">.</span><span class="n">para</span><span class="o">.</span><span class="n">ref_comp</span> <span class="o">=</span> <span class="s2">&quot;.1.&quot;</span>
<span class="n">pjt</span><span class="o">.</span><span class="n">date_begin</span> <span class="o">=</span> <span class="n">UTCDataTime</span><span class="p">(</span><span class="s1">&#39;20180701&#39;</span><span class="p">)</span>
<span class="n">pjt</span><span class="o">.</span><span class="n">date_end</span> <span class="o">=</span> <span class="n">UTCDataTime</span><span class="p">(</span><span class="s1">&#39;20190701&#39;</span><span class="p">)</span>
<span class="n">pjt</span><span class="o">.</span><span class="n">para</span><span class="o">.</span><span class="n">offset</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">pjt</span><span class="o">.</span><span class="n">para</span><span class="o">.</span><span class="n">tolerance</span> <span class="o">=</span> <span class="mi">60</span>
</pre></div>
</div>
<p>or in a configure file as above. When you want to initialize an instance using this configure file, please add the path to <code class="docutils literal notranslate"><span class="pre">RF()</span></code> as:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">pjt</span> <span class="o">=</span> <span class="n">RF</span><span class="p">(</span><span class="n">cfg_file</span><span class="o">=</span><span class="s1">&#39;path/to/config&#39;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="search-earthquakes-from-catalog">
<h2>Search earthquakes from catalog<a class="headerlink" href="#search-earthquakes-from-catalog" title="Permalink to this headline">#</a></h2>
<p>We use the same procedure as the <a class="reference external" href="https://git.nju.edu.cn/xumi1993/SplitRFLab">SplitRFLab</a>. To match the data records and events, we should search earthquakes with some criteria (period, epicentral distance and magnitude).</p>
<section id="load-station-information">
<h3>Load station information<a class="headerlink" href="#load-station-information" title="Permalink to this headline">#</a></h3>
<p>the The station latitude and longitude are absolutely necessary when we are used to search earthquakes. the function will read <code class="docutils literal notranslate"><span class="pre">stla</span></code> and <code class="docutils literal notranslate"><span class="pre">stlo</span></code> of SAC header from files in <code class="docutils literal notranslate"><span class="pre">pjt.para.datapath</span></code>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">pjt</span><span class="o">.</span><span class="n">load_stainfo</span><span class="p">()</span>
</pre></div>
</div>
</section>
</section>
<section id="search-earthquakes">
<h2>Search earthquakes<a class="headerlink" href="#search-earthquakes" title="Permalink to this headline">#</a></h2>
<p>the function provide two method to search earthquakes. use</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">pjt</span><span class="o">.</span><span class="n">search_eq</span><span class="p">()</span>
</pre></div>
</div>
<p>to search earthquakes in IRIS Web service with the CMT catalog.</p>
<p>In addition, the function allow to prepare earthquakes from a CMT catalog file (defaults to <code class="docutils literal notranslate"><span class="pre">seispy/seispy/data/EventCMT.dat</span></code>). Use command <code class="docutils literal notranslate"><span class="pre">updatecatalog</span></code> to update this default catalog file.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">pjt</span><span class="o">.</span><span class="n">search_eq</span><span class="p">(</span><span class="n">local</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="associate-sac-files-with-events">
<h2>Associate SAC files with events<a class="headerlink" href="#associate-sac-files-with-events" title="Permalink to this headline">#</a></h2>
<p>This is a important step, which allow to link SAC files and earthquakes in catalog. The <code class="docutils literal notranslate"><span class="pre">pjt.para.dateformat</span></code>, that is a format string as in <a class="reference external" href="https://docs.python.org/3/library/time.html#time.strftime">time.strftime</a>, including <code class="docutils literal notranslate"><span class="pre">datetime</span></code> information will allow to match events in catalog. For example, assuming the filename is <code class="docutils literal notranslate"><span class="pre">2018.229.15.35.02.1.sac</span></code>. the <code class="docutils literal notranslate"><span class="pre">pjt.para.dateformat</span></code> should be <code class="docutils literal notranslate"><span class="pre">%Y.%j.%H.%M.%S</span></code>.</p>
<p>A reference sac file will read to Associate with events. Thus, file-search-string will help to find real SAC files in data path. In this program file-search-string composed of <code class="docutils literal notranslate"><span class="pre">pjt.para.ref_comp</span></code> and <code class="docutils literal notranslate"><span class="pre">pjt.para.suffix</span></code>. The presence of <code class="docutils literal notranslate"><span class="pre">*pjt.para.ref_comp*pjt.para.suffix</span></code>, such as <code class="docutils literal notranslate"><span class="pre">*.1.*sac</span></code> in this example, for SAC files will be found.</p>
<p>the <code class="docutils literal notranslate"><span class="pre">pjt.para.offset</span></code> and <code class="docutils literal notranslate"><span class="pre">pjt.para.tolerance</span></code> are used to match the origin time from catalog. The definition are the same as those in <a class="reference external" href="https://git.nju.edu.cn/xumi1993/SplitRFLab">SplitRFLab</a>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ul class="simple">
<li><p>The <code class="docutils literal notranslate"><span class="pre">offset</span></code> is the time duration between the event time and the starting time of your seismograms. Ideally, this offset should be identical to the “request start time” defined in the previous window but the data management center may have sent you data beginning later than requested. The offset value represents this difference.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">Tolerance</span></code> value in seconds will define the time window within which the program will try to associate a seismic file to an event file, by using either its name or the information contained in the header. It is up to the user to find the best compromise: a value too small will let orphans and a value too large will bring confusion since several files could be associated to a seismic event.</p></li>
</ul>
</div>
<figure class="align-center" id="id1">
<img alt="offset" src="../_images/offset.png" />
<figcaption>
<p><span class="caption-text">After setting up these parameters, use following command to associate data records to the catalog:</span><a class="headerlink" href="#id1" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">pjt</span><span class="o">.</span><span class="n">match_eq</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="pre-processing">
<h2>Pre-processing<a class="headerlink" href="#pre-processing" title="Permalink to this headline">#</a></h2>
<p>The process of pretreatment include detrend, bandpass filter, calculating arrival time, reject bad record with low SNR, trim records and rotate components from NE to RT.</p>
<section id="filter">
<h3>Filter<a class="headerlink" href="#filter" title="Permalink to this headline">#</a></h3>
<p>We will apply a bandpass filter on seismic records. Two corners should be specified.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">para.freqmin</span></code>: Pass band low corner frequency.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">para.freqmax</span></code>: Pass band high corner frequency.</p></li>
</ul>
</section>
<section id="signal-noise-ratios-snr-calculation">
<h3>Signal-noise-ratios (SNR) calculation<a class="headerlink" href="#signal-noise-ratios-snr-calculation" title="Permalink to this headline">#</a></h3>
<p>seismic records with poor quality will be rejected in this step. We will reject records with SNR &lt; <code class="docutils literal notranslate"><span class="pre">para.noisegate</span></code>. The SNR was calculated as:</p>
<div class="math notranslate nohighlight">
\[  SNR = 10log_{10}\left(\frac{A_S}{A_N}\right)\]</div>
<p>where <span class="math notranslate nohighlight">\(A_N\)</span> and <span class="math notranslate nohighlight">\(A_N\)</span> are root mean squares (RMS) of the waveform trimmed with time length of <code class="docutils literal notranslate"><span class="pre">para.noiselen</span></code> before and after theoretical P arrival times, respectively.</p>
</section>
<section id="trim">
<h3>Trim<a class="headerlink" href="#trim" title="Permalink to this headline">#</a></h3>
<p>The waveforms will be cut in this step before <code class="docutils literal notranslate"><span class="pre">para.time_before</span></code> and after <code class="docutils literal notranslate"><span class="pre">para.time_after</span></code> theoretical P arrival times, respectively.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">pjt</span><span class="o">.</span><span class="n">detrend</span><span class="p">()</span>
<span class="n">pjt</span><span class="o">.</span><span class="n">filter</span><span class="p">()</span> <span class="c1"># default using &#39;para.freqmin&#39; and &#39;para.freqmax&#39;</span>
<span class="n">pjt</span><span class="o">.</span><span class="n">cal_phase</span><span class="p">()</span>
<span class="n">pjt</span><span class="o">.</span><span class="n">drop_eq_snr</span><span class="p">()</span> <span class="c1"># The threshold used as &#39;para.noisegate&#39;</span>
<span class="n">pjt</span><span class="o">.</span><span class="n">trim</span><span class="p">()</span> <span class="c1"># from &#39;para.time_before&#39; before P to &#39;para.time_after&#39; after P</span>
<span class="n">pjt</span><span class="o">.</span><span class="n">rotate</span><span class="p">()</span>
</pre></div>
</div>
</section>
</section>
<section id="saving-and-loading-this-project">
<h2>Saving and loading this project<a class="headerlink" href="#saving-and-loading-this-project" title="Permalink to this headline">#</a></h2>
<section id="save-this-project">
<h3>Save this project<a class="headerlink" href="#save-this-project" title="Permalink to this headline">#</a></h3>
<p>The class <code class="docutils literal notranslate"><span class="pre">RF</span></code> provided method to save the parameters and associated seismic events.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">pjt</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s1">&#39;path/to/pjt.pkl&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>A <code class="docutils literal notranslate"><span class="pre">pkl</span></code> file will be saved into local path, which include the subclass <code class="docutils literal notranslate"><span class="pre">pjt.para</span></code> and <code class="docutils literal notranslate"><span class="pre">pjt.eqs</span></code>. The <code class="docutils literal notranslate"><span class="pre">pjt.eqs</span></code> is a <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> instance with following columns</p>
<table class="table" id="id2">
<caption><span class="caption-text">Saved columns of the <code class="docutils literal notranslate"><span class="pre">pjt.eqs</span></code></span><a class="headerlink" href="#id2" title="Permalink to this table">#</a></caption>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Column</p></th>
<th class="head"><p>Implication</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">date</span></code></p></td>
<td><p>Origin time of the event</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">evla</span></code></p></td>
<td><p>Latitude of the event</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">evlo</span></code></p></td>
<td><p>Longitude of the event</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">evdp</span></code></p></td>
<td><p>Focal depth of the event</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">mag</span></code></p></td>
<td><p>Magnitude of the event</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">bazi</span></code></p></td>
<td><p>Back-azimuth between the station and the event</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">dis</span></code></p></td>
<td><p>Great arc distance between the station and the event</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">datestr</span></code></p></td>
<td><p>Datetime field in the associated SAC filename</p></td>
</tr>
</tbody>
</table>
</section>
<section id="load-this-project">
<h3>Load this project<a class="headerlink" href="#load-this-project" title="Permalink to this headline">#</a></h3>
<p>Create a new project and load the save project file for RF recalculation.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">newpjt</span> <span class="o">=</span> <span class="n">RF</span><span class="p">()</span>
<span class="n">newpjt</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;path/to/pjt.pkl&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ul class="simple">
<li><p>The waveform data will not be saved into file. So please ensure that the data files are exists in the <code class="docutils literal notranslate"><span class="pre">newpjt.para.datapath</span></code>.</p></li>
<li><p>The data files will be reload via <code class="docutils literal notranslate"><span class="pre">newpjt.load('path/to/pjt.pkl')</span></code>. Thus the pretreatment is necessary in recalculation.</p></li>
</ul>
</div>
</section>
</section>
<section id="prfs-calculation">
<h2>PRFs calculation<a class="headerlink" href="#prfs-calculation" title="Permalink to this headline">#</a></h2>
<p>We need parameters of <code class="docutils literal notranslate"><span class="pre">pjt.para.gauss</span></code>, <code class="docutils literal notranslate"><span class="pre">pjt.para.itmax</span></code> and <code class="docutils literal notranslate"><span class="pre">pjt.para.minderr</span></code> to calculate PRFs using iterative time-domain deconvolution method</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">pjt.para.gauss</span></code>: Gauss factor. Default is 2.0.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">pjt.para.itmax</span></code>: The maximum number of iterations. Default is 400.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">pjt.para.minderr</span></code>: The minimum misfit. Default is 0.001.</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">pjt</span><span class="o">.</span><span class="n">deconv</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="save-prfs">
<h2>Save PRFs<a class="headerlink" href="#save-prfs" title="Permalink to this headline">#</a></h2>
<p>Save the PRFs to <code class="docutils literal notranslate"><span class="pre">pjt.para.rfpath</span></code> with some criteria. Two kind of criteria allow to set (i.e., <code class="docutils literal notranslate"><span class="pre">crust</span></code> or <code class="docutils literal notranslate"><span class="pre">mtz</span></code>). if the parameter set as None, all of PRFs will be saved.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">crust</span></code></p>
<ul>
<li><p>The maximum peak should appear between -2s and 2s.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">mtz</span></code></p>
<ul>
<li><p>The maximum peak should appear between -5s and 5s.</p></li>
<li><p>the maximum amplitudes of PRFs in a 30–120 s window after the direct P are smaller than 30% of the maximum amplitudes of the direct P phases.</p></li>
</ul>
</li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">pjt</span><span class="o">.</span><span class="n">saverf</span><span class="p">(</span><span class="n">criterion</span><span class="o">=</span><span class="s1">&#39;crust&#39;</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>


              </article>
              

              
              <footer class="bd-footer-article">
                  <!-- Previous / next buttons -->
<div class='prev-next-area'>
  <a class='left-prev' id="prev-link" href="PRF_Process.html" title="previous page">
      <i class="fas fa-angle-left"></i>
      <div class="prev-next-info">
          <p class="prev-next-subtitle">previous</p>
          <p class="prev-next-title">Calculate a P-wave Receiver Function (PRF)</p>
      </div>
  </a>
  <a class='right-next' id="next-link" href="srf.html" title="next page">
  <div class="prev-next-info">
      <p class="prev-next-subtitle">next</p>
      <p class="prev-next-title">Calculate S wave Receiver Functions (SRF) for single station</p>
  </div>
  <i class="fas fa-angle-right"></i>
  </a>
</div>
              </footer>
              
          </div>
          
      </div>
    </div>

  
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/pydata-sphinx-theme.js?digest=92025949c220c2e29695"></script>

<footer class="bd-footer"><div class="bd-footer__inner container">
  
  <div class="footer-item">
    <p class="copyright">
    &copy; Copyright 2020, Mijian Xu.<br>
</p>
  </div>
  
  <div class="footer-item">
    <p class="sphinx-version">
Created using <a href="http://sphinx-doc.org/">Sphinx</a> 4.5.0.<br>
</p>
  </div>
  
</div>
</footer>
  </body>
</html>